---
import type { CollectionEntry } from "astro:content";
import BlogPostHeader from "@components/Blog/BlogPostHeader.astro";
import type { Collection } from "@components/Blog/utils/getAllPosts";

interface Props {
    post: CollectionEntry<"blog">;
    collection?: Collection;
}

const {
    post: { slug, data },
    collection = "blog",
} = Astro.props;
const { draft, title, date } = data;
const future = new Date(date) > new Date();
---

<article
    class:list={[
        "post-preview",
        { draft: draft, future: future },
    ]}
>
    <BlogPostHeader
        date={date}
        title={title}
        slug={`${collection}/${slug}`}
        viewTransitionName={slug}
        isPreview
    />
</article>

<style is:global>
    @scope (.post-preview) {
        :scope {
            anchor-name: --parent;
            anchor-scope: --parent;

            content-visibility: auto;
            contain-intrinsic-size: 200px; /* Explained in the next section. */
        }

        &.draft,
        &.future {
            &::after {
                content: var(--content);
                text-align: center;
                color: white;
                writing-mode: vertical-rl;
                height: 30px;
                width: 30px;
                display: block;
                background: red;
                position-anchor: --parent;
                position: fixed;
                top: anchor(top);
                right: anchor(left);
                translate: -50%;
                height: anchor-size();
            }
        }

        &.draft {
            --content: "draft";
        }

        &.future {
            --content: "future";
        }
    }
</style>
