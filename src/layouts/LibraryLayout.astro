---
import DefaultLayout from '@layouts/DefaultLayout.astro'
import Bookcase from 'src/components/Svelte/Bookcase.svelte'

import { getBooks } from 'src/utils/getBooksFromNotion'

import dayjs from 'dayjs'
import customParseFormat from 'dayjs/plugin/customParseFormat'
dayjs.extend(customParseFormat)

const { title }  = Astro.props;

const locale = Astro.currentLocale;

const allBooks = await getBooks()
const books = allBooks
	.filter(({ finishedDate }: { finishedDate: Date }) => {
		const date = dayjs(finishedDate)
		return date.isValid()
	})
	.sort((a: Date, b: Date) => {
		return dayjs(b, 'MM-YYYY').diff(dayjs(a, 'MM-YYYY'))
	})

---


<DefaultLayout title={title} accent="oklch(0.52 0.12 189.58)">
    <slot />

    <Bookcase 
        client:visible 
        books={books}
        locale={locale}
        text={locale === 'fr' ? {
            fallback: "aucun livre renvoyé par l'API.",
            completed: "terminés",
            book: "livre",
            month: "mois",
            year: "année",
            by: "de",
        } : undefined}
    />
</DefaultLayout>

<style>
    :global(details) {
      margin-block-end: 3rem;
    }
  </style>