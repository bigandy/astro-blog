---
import { type CollectionEntry } from "astro:content";

import BlogPost from "@components/Blog/BlogPost.astro";
import { getAllPosts } from "@components/Blog/utils/getAllPosts";
import DefaultLayout from "@layouts/DefaultLayout.astro";
import FullPageLayout from "@layouts/FullPageLayout.astro";

export const prerender = true;

export async function getStaticPaths() {
	const posts = await getAllPosts();

	return posts.map((post) => {
		return {
			params: { slug: post.id },
			props: {
				postIndex: post.postIndex,
				post,
			},
		};
	});
}

interface Props {
	post: CollectionEntry<"blog">;
	postIndex: number;
}

const { post, postIndex } = Astro.props;
const { template, title } = post.data;
const slug = `blog/${post.id}/`;
---

{
    template === "full-page" ? (
        <FullPageLayout title={title} permalink={slug}>
            <BlogPost
                post={post}
                showBackLink={true}
                permalink={post.id}
                postIndex={postIndex}
            />
        </FullPageLayout>
    ) : (
        <DefaultLayout title={post.data.title} hideTitle>
            <BlogPost post={post} postIndex={postIndex} />
        </DefaultLayout>
    )
}
