---
import { Temporal } from "@js-temporal/polyfill";
import { type Role } from "@pages/cv/content";

interface Props {
	role: Role;
	company: string;
	overrideFullDates?: boolean;
}

const { role, company, overrideFullDates = false } = Astro.props;

const padStartNumber = (number: number) => {
	return (`0${number}`).slice(-2);
};

const getDateOutput = (
	date: Temporal.PlainYearMonth,
	overrideFullDates: boolean,
	showFulldate: boolean,
) => {
	// const dateTemporal = Temporal.PlainDate.from(date);

	// return getDayMonthYear(date);

	if (overrideFullDates || showFulldate === false) {
		return date.year;
	}

	return `${padStartNumber(date.month)}/${date.year}`;
};

const getDayMonthYear = (date: Temporal.PlainDate) => {
	return `${padStartNumber(date.day)}-${padStartNumber(date.month)}-${date.year}`;
};
---

<li class="entrylist__item h-event p-experience">
    <article class="entry">
        <div class="entry__header">
            <h3 class="entry__title p-name">
                {role.title}
            </h3>

            <p class="entry__organization p-org h-card">
                <a href={role.url} class="p-name u-url" rel="noreferrer">
                    {company}
                </a>
            </p>

            <p class="entry__time">
                <time
                    class="dt-start"
                    datetime={getDayMonthYear(role.start)}
                    >{
                        getDateOutput(
                            role.start,
                            overrideFullDates,
                            role.showFullDates
                        )
                    }</time
                >
                <span>–</span>
                <time
                    class="dt-end"
                    >{
                        getDateOutput(
                            role.end,
                            overrideFullDates,
                            role.showFullDates
                        )
                    }</time
                ><span aria-hidden="true">·</span><span class="p-location"
                    >{role.location}</span
                >
            </p>
        </div>

        <div class="entry__content p-summary">
            <ul>
                {
                    role.summary.map((point: string) => {
                        return <li>{point}</li>;
                    })
                }
            </ul>
        </div>
    </article>
</li>
